<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hamster Tamagotchi Widget</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root {
      /* === í”„ë ˆì„ ì„¤ì • (frame.png ê¸°ì¤€) === */
      --frame-w: 673px;
      --frame-h: 673px; /* ì •ì‚¬ê°í˜•ì— ê°€ê¹Œìš´ ë¹„ìœ¨ë¡œ ì¶”ì •ë¨ */
      
      /* ìƒ‰ìƒ í…Œë§ˆ */
      --color-screen-bg: #fdf6e3; /* ë©”ì¸ í™”ë©´ ë°°ê²½ìƒ‰ (ì´ë¯¸ì§€ ë¡œë“œ ì „) */
      --color-ui-bg: #e8dcb9;     /* í•˜ë‹¨ ì •ë³´ì°½ ë°°ê²½ìƒ‰ (ë² ì´ì§€) */
      --color-text: #4a3b32;      /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ê°ˆìƒ‰) */
      --color-accent: #00ff00;    /* ê²½í—˜ì¹˜ ë°” (í˜•ê´‘ ì´ˆë¡) */
    }

    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: grid;
      place-items: center;
      background-color: #1a1a1a;
      font-family: 'Press Start 2P', cursive;
      overflow: hidden;
    }

    /* === ì „ì²´ ì»¨í…Œì´ë„ˆ === */
    .device-container {
      position: relative;
      width: var(--frame-w);
      height: var(--frame-h);
      /* í™”ë©´ í¬ê¸°ì— ë§ì¶° ìë™ ì¶•ì†Œ */
      transform-origin: center center;
      transform: scale(0.8); 
    }

    /* === ë ˆì´ì–´ 1: í”„ë ˆì„ (ë§¨ ìœ„) === */
    .layer-frame {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 100; /* ì œì¼ ìœ„ì— ë°°ì¹˜ */
      pointer-events: none; /* í´ë¦­ í†µê³¼ */
    }
    .layer-frame img {
      width: 100%;
      display: block;
    }

    /* === ë ˆì´ì–´ 2: ë©”ì¸ í™”ë©´ (ìœ„ìª½ êµ¬ë©) === */
    /* frame.pngì˜ ìœ„ìª½ íˆ¬ëª… ì˜ì—­ì— ë§ì¶˜ ì¢Œí‘œ */
    .screen-top {
      position: absolute;
      top: 130px;    /* ìœ„ì—ì„œë¶€í„°ì˜ ê±°ë¦¬ */
      left: 135px;   /* ì™¼ìª½ì—ì„œë¶€í„°ì˜ ê±°ë¦¬ */
      width: 400px;  /* í™”ë©´ ë„ˆë¹„ */
      height: 300px; /* í™”ë©´ ë†’ì´ */
      background-color: var(--color-screen-bg);
      z-index: 10;
      overflow: hidden;
      border-radius: 20px;
    }

    /* ë°°ê²½ ì´ë¯¸ì§€ */
    .bg-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      image-rendering: pixelated;
    }

    /* í–„ìŠ¤í„° ìºë¦­í„° ê³µí†µ */
    .character {
      position: absolute;
      width: 180px;  /* ìºë¦­í„° í¬ê¸° ì¡°ì • */
      height: 180px;
      left: 50%;
      top: 55%;      /* ë°”ë‹¥(í†±ë°¥) ìœ„ì— ì„œ ìˆëŠ” ìœ„ì¹˜ */
      transform: translate(-50%, -50%);
      image-rendering: pixelated;
      transition: opacity 0.2s;
    }

    /* IDLE ìƒíƒœ ì• ë‹ˆë©”ì´ì…˜ (ìˆ¨ì‰¬ê¸°) */
    .character.idle {
      animation: breathe 2s infinite ease-in-out;
    }
    @keyframes breathe {
      0%, 100% { transform: translate(-50%, -50%) scaleY(1); }
      50% { transform: translate(-50%, -50%) scaleY(1.05); }
    }

    /* Running ìƒíƒœ (ì³‡ë°”í€´ ìŠ¤í”„ë¼ì´íŠ¸) */
    /* ë°°ê²½ì˜ ì³‡ë°”í€´ ìœ„ì¹˜ì— ì •í™•íˆ ë®ì–´ì”Œì›Œì•¼ í•¨ */
    .character.running {
      opacity: 0; /* img íƒœê·¸ ìˆ¨ê¸°ê¸° */
    }
    
    /* Running ìƒíƒœë¥¼ ìœ„í•œ ìŠ¤í”„ë¼ì´íŠ¸ ì˜¤ë²„ë ˆì´ */
    .sprite-overlay {
      display: none;
      position: absolute;
      /* ë°°ê²½ ì´ë¯¸ì§€ì˜ ì³‡ë°”í€´ ìœ„ì¹˜ì— ë§ì¶° ì¡°ì • */
      left: 20px; 
      top: 40px;
      width: 280px;
      height: 280px;
      background-image: url('./assets/wheel.png');
      background-size: 400% 200%; /* 2í–‰ 4ì—´ (8í”„ë ˆì„) */
      background-repeat: no-repeat;
      background-position: 0% 0%;
      image-rendering: pixelated;
      z-index: 20;
    }
    .sprite-overlay.active {
      display: block;
      animation: runSprite 0.8s steps(8) infinite;
    }

    @keyframes runSprite {
      0%{   background-position: 0%    0%; }    /* í”„ë ˆì„ 1 */
      12.5%{ background-position: 33.33% 0%; }  /* í”„ë ˆì„ 2 */
      25%{  background-position: 66.66% 0%; }  /* í”„ë ˆì„ 3 */
      37.5%{ background-position: 100%   0%; }  /* í”„ë ˆì„ 4 */
      50%{  background-position: 0%    100%; }  /* í”„ë ˆì„ 5 */
      62.5%{ background-position: 33.33% 100%; } /* í”„ë ˆì„ 6 */
      75%{  background-position: 66.66% 100%; } /* í”„ë ˆì„ 7 */
      87.5%{ background-position: 100%   100%; } /* í”„ë ˆì„ 8 */
      100%{ background-position: 0%    0%; }    /* ì²˜ìŒìœ¼ë¡œ */
    }

    /* === ë ˆì´ì–´ 3: ì •ë³´ í™”ë©´ (ì•„ë˜ìª½ êµ¬ë©) === */
    /* frame.pngì˜ ì•„ë˜ìª½ íˆ¬ëª… ì˜ì—­ì— ë§ì¶˜ ì¢Œí‘œ */
    .screen-bottom {
      position: absolute;
      top: 460px;
      left: 135px;
      width: 400px;
      height: 120px;
      background-color: var(--color-ui-bg); /* ë² ì´ì§€ìƒ‰ ë°°ê²½ */
      z-index: 10;
      padding: 15px;
      box-sizing: border-box;
      display: flex;
      flex-direction: row; /* ì¢Œìš° ë°°ì¹˜ */
      gap: 15px;
      border-radius: 10px;
    }

    /* ì™¼ìª½ íŒ¨ë„: ë ˆë²¨/ê²½í—˜ì¹˜ */
    .stat-panel {
      flex: 0 0 180px; /* ê³ ì • ë„ˆë¹„ */
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .stat-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--color-text);
    }

    /* ê²½í—˜ì¹˜ ë°” ë””ìì¸ */
    .exp-container {
      flex-grow: 1;
      height: 14px;
      background: #555;
      border: 2px solid #000;
      position: relative;
      min-width: 120px;
    }
    .exp-fill {
      width: 0%;
      height: 100%;
      background-color: var(--color-accent);
      transition: width 0.3s ease-out;
      box-shadow: 0 0 5px var(--color-accent);
    }

    /* ì˜¤ë¥¸ìª½ íŒ¨ë„: ë¡œê·¸ ì˜ì—­ */
    .log-panel {
      flex: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
      display: flex;
      flex-direction: column;
    }

    .log-title {
      font-size: 10px;
      color: var(--color-text);
      margin-bottom: 4px;
    }

    .log-area {
      flex: 1;
      background: rgba(255, 255, 255, 0.5);
      border: 2px solid #bba;
      font-size: 9px;
      padding: 6px;
      overflow-y: auto;
      color: #333;
      line-height: 1.4;
      min-height: 0; /* flexì—ì„œ ìŠ¤í¬ë¡¤ ì‘ë™í•˜ê²Œ */
    }

    /* === ê°œë°œìš© ë²„íŠ¼ (í™”ë©´ ë°–) === */
    .controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 200;
    }
    .btn {
      background: #fff;
      border: 4px solid #000;
      padding: 10px;
      font-family: inherit;
      cursor: pointer;
      font-size: 10px;
    }
    .btn:active { transform: scale(0.95); }

  </style>
</head>
<body>

  <div class="device-container" id="device">
    
    <div class="layer-frame">
      <img src="./assets/frame.png" alt="Frame">
    </div>

    <div class="screen-top">
      <img src="./assets/bg.png" class="bg-image" alt="Background">
      
      <img src="./assets/normal.png" class="character idle" id="charImg" alt="Character">
      
      <div class="sprite-overlay" id="wheelSprite"></div>
    </div>

    <div class="screen-bottom">
      <!-- ì™¼ìª½: ë ˆë²¨/ê²½í—˜ì¹˜ -->
      <div class="stat-panel">
        <div class="stat-row">
          <span>LV.<span id="levelVal">1</span></span>
        </div>
        <div class="stat-row">
          <span>EXP</span>
          <div class="exp-container">
            <div class="exp-fill" id="expFill"></div>
          </div>
        </div>
      </div>
      
      <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ -->
      <div class="log-panel">
        <div class="log-title">LOG</div>
        <div class="log-area" id="logText">
          <div>> Welcome to Hamster World!</div>
        </div>
      </div>
    </div>

  </div>

  <div class="controls">
    <button class="btn" onclick="triggerAction('routine')">ğŸ‹ï¸ Routine (+20 EXP)</button>
    <button class="btn" onclick="triggerAction('task')">ğŸ“ Task (+10 EXP)</button>
    <button class="btn" onclick="resetGame()">ğŸ”„ Reset</button>
  </div>

  <script>
    /* === ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ === */
    const charImg = document.getElementById('charImg');
    const wheelSprite = document.getElementById('wheelSprite');
    const expFill = document.getElementById('expFill');
    const levelVal = document.getElementById('levelVal');
    const logText = document.getElementById('logText');

    let state = {
      level: 1,
      exp: 0,
      status: 'IDLE', // IDLE, RUNNING, EATING, SAD
      isBusy: false
    };

    // ì´ˆê¸°í™”
    function init() {
      renderUI();
      // ë°˜ì‘í˜• ìŠ¤ì¼€ì¼ë§
      window.addEventListener('resize', fitToScreen);
      fitToScreen();
    }

    // í™”ë©´ í¬ê¸°ì— ë§ì¶° ê¸°ê¸° í¬ê¸° ì¡°ì ˆ
    function fitToScreen() {
      const container = document.getElementById('device');
      const scale = Math.min(window.innerWidth / 700, window.innerHeight / 750);
      container.style.transform = `scale(${scale})`;
    }

    function triggerAction(type) {
      if (state.isBusy) return;
      state.isBusy = true;

      if (type === 'routine') {
        // ë£¨í‹´ ì™„ë£Œ -> ì³‡ë°”í€´ ë‹¬ë¦¬ê¸°
        log("> Routine Complete! Running...");
        setExp(20);
        
        // 1. ìºë¦­í„° ìˆ¨ê¸°ê³  ìŠ¤í”„ë¼ì´íŠ¸ ì¼œê¸°
        charImg.style.display = 'none';
        wheelSprite.classList.add('active');
        
        // 4ì´ˆ ë’¤ ë³µê·€
        setTimeout(() => {
          wheelSprite.classList.remove('active');
          charImg.style.display = 'block';
          state.isBusy = false;
        }, 4000);

      } else if (type === 'task') {
        // í• ì¼ ì™„ë£Œ -> ë¨¹ê¸°
        log("> Task Done! Yummy!");
        setExp(10);
        
        // ì´ë¯¸ì§€ ë³€ê²½
        charImg.src = './assets/eat.png';
        charImg.className = 'character'; // idle ì• ë‹ˆë©”ì´ì…˜ ë„ê¸°
        
        setTimeout(() => {
          charImg.src = './assets/normal.png';
          charImg.className = 'character idle';
          state.isBusy = false;
        }, 3000);
      }
    }

    function setExp(amount) {
      state.exp += amount;
      if (state.exp >= 100) {
        state.level++;
        state.exp -= 100;
        log(`ğŸ‰ Level Up! LV.${state.level}`);
        
        // ë ˆë²¨ì—… ë¦¬ì•¡ì…˜ (Happy)
        const prevSrc = charImg.src;
        charImg.src = './assets/happy.png';
        setTimeout(() => {
          if(!state.isBusy) charImg.src = './assets/normal.png';
        }, 2000);
      }
      renderUI();
    }

    function renderUI() {
      levelVal.innerText = state.level;
      expFill.style.width = `${state.exp}%`;
    }

    function log(msg) {
      const entry = document.createElement('div');
      entry.textContent = msg;
      entry.style.marginBottom = '2px';
      logText.insertBefore(entry, logText.firstChild);
      
      // ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ í‘œì‹œ
      while (logText.children.length > 5) {
        logText.removeChild(logText.lastChild);
      }
    }

    function resetGame() {
      state.level = 1;
      state.exp = 0;
      state.isBusy = false;
      charImg.style.display = 'block';
      charImg.src = './assets/normal.png';
      charImg.className = 'character idle';
      wheelSprite.classList.remove('active');
      renderUI();
      logText.innerHTML = '<div>> Welcome to Hamster World!</div>';
    }

    init();
  </script>
</body>
</html>